add_executable(ForKKParallelFor Fortran_main.f90 Fortran_kernel.F90 hello_world.cpp)  
target_link_libraries(ForKKParallelFor cabanacore)
add_test(NAME Fortran_tutorial_06 COMMAND ForKKParallelFor)
set_property(TARGET ForKKParallelFor PROPERTY LINKER_LANGUAGE Fortran)

if(CMAKE_Fortran_COMPILER_ID STREQUAL "PGI")
  if( Cabana_ENABLE_Cuda )
    target_compile_definitions(ForKKParallelFor PUBLIC -DUSE_GPU=1)
    set(CMAKE_Fortran_FLAGS "-ta=tesla:cuda9.0 -Minfo=accel -Mcuda=cuda9.0")
    set(CMAKE_CXX_FLAGS "--relocatable-device-code=true")
  elseif( Cabana_ENABLE_OpenMP )
    target_compile_definitions(ForKKParallelFor PUBLIC -DUSE_GPU=0)
    set(CMAKE_Fortran_FLAGS "-ta=multicore -mp")
  elseif( Cabana_ENABLE_Serial )
    target_compile_definitions(ForKKParallelFor PUBLIC -DUSE_GPU=0)
    set(CMAKE_Fortran_FLAGS "-ta=host")
  endif()
  
  set(CMAKE_EXE_LINKER_FLAGS "-pgc++libs")
  
else()
  message("Only PGI is supported for compiling fortran cuda code.\n Skip.")
  return()
endif()

